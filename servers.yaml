# Template for MCP server process definitions.
# CLI/Env override priority (future phases): --mock > ALLOW_REAL=1 > mode below.

services:
  slack:
    mode: real  # real | mock (default real)
    kind: binary  # Go binary from korotovsky/slack-mcp-server
    exec: ~/go/bin/slack-mcp-server
    args: []
    workdir: .
    env:
      # slack-mcp-server expects SLACK_MCP_XOXP_TOKEN (User OAuth token).
      # We map it from SLACK_USER_TOKEN defined in .env for backward compatibility.
      SLACK_MCP_XOXP_TOKEN: ${SLACK_USER_TOKEN}
    auth_files:
      - path: secrets/slack_token.json
        description: Cache file if the server persists tokens locally.
    mock:
      exec: python
      args:
        - -m
        - tests.mocks.slack_server
      workdir: .

  github:
    mode: real  # real | mock
    kind: node  # @modelcontextprotocol/server-github (Node)
    exec: npx
    args:
      - -y
      - "@modelcontextprotocol/server-github"
    workdir: .
    env:
      GITHUB_TOKEN: ${GITHUB_TOKEN}
    auth_files:
      - path: secrets/github_token.json
        description: Optional cached OAuth token; PAT is primary.
    mock:
      exec: python
      args:
        - -m
        - tests.mocks.github_server
      workdir: .

  drive:
    mode: real  # real | mock
    kind: node  # @modelcontextprotocol/server-gdrive (Node)
    exec: npx
    args:
      - -y
      - "@modelcontextprotocol/server-gdrive"
    workdir: .
    env:
      GDRIVE_CREDENTIALS_PATH: ${DRIVE_TOKEN_PATH}
      GDRIVE_OAUTH_PATH: ${GOOGLE_CREDENTIALS_PATH}
    auth_files:
      - path: ${DRIVE_TOKEN_PATH}
        description: OAuth token.json saved after first consent.
    mock:
      exec: python
      args:
        - -m
        - tests.mocks.gdrive_server
      workdir: .
